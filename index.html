<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MBI Game Center - Koleksi Quiz Pintar</title>
    
    <!-- 1. Memuat file gaya -->
    <link rel="stylesheet" href="style.css">
    
    <!-- Memuat library Tone.js untuk manajemen audio -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.min.js"></script>
    
    <!-- 2. SETUP FIREBASE DAN AUTENTIKASI (KRITIS UNTUK AKSES VARIABEL LINGKUNGAN) -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, updateDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Variabel global yang disediakan oleh lingkungan
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        if (Object.keys(firebaseConfig).length > 0) {
            // Inisialisasi layanan Firebase dan mengeksposnya ke window
            const app = initializeApp(firebaseConfig);
            window.db = getFirestore(app);
            window.auth = getAuth(app);
            window.appId = appId;
            setLogLevel('Debug'); 

            async function authenticate() {
                try {
                    if (initialAuthToken) {
                        await signInWithCustomToken(window.auth, initialAuthToken);
                    } else {
                        await signInAnonymously(window.auth);
                    }
                } catch (error) {
                    console.error("Kesalahan Autentikasi:", error);
                }
            }

            onAuthStateChanged(window.auth, (user) => {
                if (user) {
                    window.userId = user.uid;
                    window.isAuthReady = true;
                    // Panggil fungsi inisialisasi utama dari app.js
                    if (window.initAppLogic) {
                        window.initAppLogic();
                    }
                } else {
                    window.userId = null;
                    window.isAuthReady = true; 
                }
            });

            authenticate();
        } else {
            console.error("Konfigurasi Firebase hilang. Aplikasi tidak dapat menyimpan data.");
            window.isAuthReady = true;
            if (window.initAppLogic) {
                window.initAppLogic(); // Tetap panggil untuk logika UI tanpa Firebase
            }
        }
    </script>
</head>
<body>
    
    <!-- AUDIO START OVERLAY -->
    <div id="audio-start-overlay" class="audio-start-overlay">
        <button id="start-audio-button" class="start-audio-button">
            Ketuk untuk Mulai Game
        </button>
        <p class="audio-note">Memuat musik latar dan efek suara.</p>
    </div>

    <div class="container">
        <!-- HEADER KIRI (Poin, Koin, Papan Peringkat, Iklan) -->
        <aside class="left-panel">
            <div class="score-item">
                <label>Poin:</label>
                <div class="score-value" id="user-points">0</div>
            </div>
            <div class="score-item">
                <label>Koin:</label>
                <div class="score-value" id="user-coins">0</div>
            </div>
            <a href="#" class="leaderboard-button" id="leaderboard-btn">Papan peringkat</a>
            <a href="#" class="ad-button" id="ad-btn">Tonton iklan (+50 Koin)</a>
        </aside>
        
        <!-- KONTEN UTAMA -->
        <main class="main-content">
            <div class="logo-area">
                <div class="center-logo" role="img" aria-label="Logo">ðŸ§ </div>
                <div class="logo-text">Tempat Koleksi Kuis Pintar</div>
            </div>

            <h1 class="main-title">Koleksi Game Quiz Spesial</h1>
            <p class="subtitle">Bermain Dan Belajar</p>

            <div class="game-grid">
                <!-- Game Cards -->
                <a href="#" class="game-card game-1" data-game="tebak-mbi">
                    <div class="game-title">TEBAK MBI</div>
                    <div class="game-version">Versi MBI</div>
                </a>
                <a href="#" class="game-card game-2" data-game="quiz-pintar">
                    <div class="game-title">QUIZ PINTAR</div>
                    <div class="game-version">Versi MBI</div>
                </a>
                <a href="#" class="game-card game-3" data-game="tebaklah-aku">
                    <div class="game-title">TEBAKLAH AKU</div>
                    <div class="game-version">Versi MBI</div>
                </a>
                <a href="#" class="game-card game-4" data-game="matematika-ninja">
                    <div class="game-title">MATEMATIKA NINJA</div>
                    <div class="game-version">Versi MBI</div>
                </a>
                <a href="#" class="game-card game-5" data-game="tebak-gambar">
                    <div class="game-title">TEBAK GAMBAR</div>
                    <div class="game-version">Versi MBI</div>
                </a>
                <a href="#" class="game-card game-6" data-game="tebak-kata">
                    <div class="game-title">TEBAK KATA</div>
                    <div class="game-version">Versi MBI</div>
                </a>
            </div>

            <!-- FOOTER BANNER -->
            <div class="banner-ads">
                Iklan banner/banner ads
            </div>

            <!-- COPYRIGHT -->
            <footer class="copyright">
                &copy; 2025 MBI Game Center
                <div id="user-info" style="margin-top: 5px; font-size: 10px; color: #777;">ID Pengguna: Menunggu...</div>
            </footer>
        </main>
    </div>
    
    <!-- CUSTOM MODAL HTML -->
    <div id="custom-modal" class="custom-modal">
        <div class="modal-content">
            <span class="close-button">&times;</span>
            <p id="modal-text"></p>
            <button class="modal-ok-button">OK</button>
        </div>
    </div>
    
    <!-- 3. Memuat file JavaScript aplikasi utama -->
    <script src="app.js" type="text/javascript"></script>
</body>
</html>
